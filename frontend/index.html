<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCTS Regenwormen Simulator</title>
    <link rel="stylesheet" href="style.css?v=2">
</head>

<body>
    <div class="container">
        <h1>MCTS Regenwormen Simulator</h1>

        <form id="game-form">
            <!-- Dice Selection Panel -->
            <div class="section">
                <h2>Add Dice</h2>
                <div class="dice-controls">
                    <button type="button" class="die-btn" onclick="addDieToFocus(1)" aria-label="Add 1">
                        <div class="die-face">
                            <div class="dot" style="grid-column: 2; grid-row: 2;"></div>
                        </div>
                    </button>
                    <button type="button" class="die-btn" onclick="addDieToFocus(2)" aria-label="Add 2">
                        <div class="die-face">
                            <div class="dot" style="grid-column: 1; grid-row: 3;"></div>
                            <div class="dot" style="grid-column: 3; grid-row: 1;"></div>
                        </div>
                    </button>
                    <button type="button" class="die-btn" onclick="addDieToFocus(3)" aria-label="Add 3">
                        <div class="die-face">
                            <div class="dot" style="grid-column: 1; grid-row: 3;"></div>
                            <div class="dot" style="grid-column: 2; grid-row: 2;"></div>
                            <div class="dot" style="grid-column: 3; grid-row: 1;"></div>
                        </div>
                    </button>
                    <button type="button" class="die-btn" onclick="addDieToFocus(4)" aria-label="Add 4">
                        <div class="die-face">
                            <div class="dot" style="grid-column: 1; grid-row: 1;"></div>
                            <div class="dot" style="grid-column: 3; grid-row: 1;"></div>
                            <div class="dot" style="grid-column: 1; grid-row: 3;"></div>
                            <div class="dot" style="grid-column: 3; grid-row: 3;"></div>
                        </div>
                    </button>
                    <button type="button" class="die-btn" onclick="addDieToFocus(5)" aria-label="Add 5">
                        <div class="die-face">
                            <div class="dot" style="grid-column: 1; grid-row: 1;"></div>
                            <div class="dot" style="grid-column: 3; grid-row: 1;"></div>
                            <div class="dot" style="grid-column: 2; grid-row: 2;"></div>
                            <div class="dot" style="grid-column: 1; grid-row: 3;"></div>
                            <div class="dot" style="grid-column: 3; grid-row: 3;"></div>
                        </div>
                    </button>
                    <button type="button" class="die-btn" onclick="addDieToFocus(6)" aria-label="Add Worm">
                        <div class="worm-face">ðŸª±</div>
                    </button>
                </div>
            </div>

            <!-- Hand State -->
            <div class="section">
                <div class="pool-label-row">
                    <h2>Current Hand</h2>
                    <span id="hand-count" class="count-badge">0/8</span>
                </div>
                <!-- Hidden input for form submission logic compatibility if needed later -->
                <input type="hidden" id="hand" name="hand">

                <div id="hand-pool" class="dice-pool" onclick="setFocus('hand')">
                    <span style="color: grey; font-style: italic; font-size: 0.9em; width: 100%; text-align: center;"
                        id="hand-placeholder">Click dice above to add to Hand</span>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn-secondary" onclick="clearPool('hand')">Clear Hand</button>
                    <button type="button" class="btn-secondary" onclick="setFocus('hand')">Select Hand</button>
                </div>
            </div>

            <!-- Dice Throw State -->
            <div class="section">
                <div class="pool-label-row">
                    <h2>Current Throw</h2>
                    <span id="throw-count" class="count-badge">0/8</span>
                </div>
                <input type="hidden" id="dice_throw" name="dice_throw">

                <div id="throw-pool" class="dice-pool" onclick="setFocus('throw')">
                    <span style="color: grey; font-style: italic; font-size: 0.9em; width: 100%; text-align: center;"
                        id="throw-placeholder">Click dice above to add to Throw</span>
                </div>
                <div class="action-buttons">
                    <button type="button" class="btn-secondary" onclick="clearPool('throw')">Clear Throw</button>
                    <button type="button" class="btn-secondary" onclick="setFocus('throw')">Select Throw</button>
                </div>
            </div>

            <div class="error-msg" id="validation-error"></div>

            <div class="section slider-container">
                <label for="simulations">Simulations: <span id="sim-value">10000</span></label>
                <input type="range" id="simulations" name="simulations" min="1000" max="25000" value="10000" step="500">
            </div>

            <button type="submit" id="submit-btn" class="cta-button">Analyze with MCTS</button>
        </form>

        <div id="results" style="display: none;">
            <div class="section">
                <h2>Analysis Results</h2>
                <table id="results-table">
                    <thead>
                        <tr>
                            <th>Action</th>
                            <th>Expected Score</th>
                            <th>Visit Count</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="section">
                <h3>Convergence Graph</h3>
                <div class="chart-container">
                    <canvas id="convergence-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
</body>

</html>
